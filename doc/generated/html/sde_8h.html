<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AP Service Publisher: sde.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>sde.h File Reference</h1>The Service Description Exchange data and packet structures. A Service description exchange (<b>SDE</b>) happens when a user connects to a particular AP to retrieve the details of the <a class="el" href="structservice.html">service</a> offered in the SSID. The data exchange will be modeled after the latest Android ToDo protocol that employs static packet structures and TLV chunks. The data are aligned properly as can be seen in detail in the C implementation at the end of this document. Once the gadget gets an IP address, it should connect to UDP port 30003 to start the following communication sequence:.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;stdint.h&gt;</code><br>
<code>#include &quot;<a class="el" href="tlv_8h-source.html">tlv.h</a>&quot;</code><br>

<p>
<a href="sde_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmetadata.html">metadata</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structposition.html">position</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__packet.html">sde_packet</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__get__metadata.html">sde_get_metadata</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__metadata.html">sde_metadata</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__metadata__data.html">sde_metadata_data</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__get__service__desc.html">sde_get_service_desc</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__get__service__desc__data.html">sde_get_service_desc_data</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__service__desc.html">sde_service_desc</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsde__service__desc__data.html">sde_service_desc_data</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sde_8h.html#3cae2d1065c37163cc29ca5874abb904">SDE_PORT</a>&nbsp;&nbsp;&nbsp;30003</td></tr>

<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28">service_desc_chunk_type</a> { <br>
&nbsp;&nbsp;<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28b6018339139b51a498dc44bd760766fc">DESCRIPTION</a>, 
<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28feaef8a658b26a4d579bc6b737454b22">SERVICE_POS</a>, 
<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28267d1e553ddae7b4a94965d90362173d">SERVICE_TS</a>, 
<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28266791ced345bfe6511dd4acab8d0b28">SERVICE_LONG_DESC</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28dff633207be6c7a92d0462413ae8ce7e">SERVICE_URI</a>, 
<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28f09c66ca77d031a035371f689ff64f6f">SERVICE_SHORT_DESC</a>, 
<a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a2868ddd2ab2bd2b40f8c7f3fa8983fd321">SERVICE_CAT_ID</a>
<br>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d640">sde_packet_type</a> { <br>
&nbsp;&nbsp;<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d6404428e5f642432448da74290c4a70173e">GET_METADATA</a>, 
<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d6400e1d7082456940b59823eed8099493ca">METADATA</a>, 
<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d640e4d7b97f100ece56b1dcfb19d8312fdc">METADATA_DATA</a>, 
<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d640c626f3311c4accefb1fe659e53ffab61">GET_SERVICE_DESC</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d640bd8f61f35a1f8df3f3d535b16440a1dc">GET_SERVICE_DESC_DATA</a>, 
<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d6400c6eddfb28096f33fc47e0eaa0588d88">SERVICE_DESC</a>, 
<a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d640acc47865511e3fb052c9777361bf5bda">SERVICE_DESC_DATA</a>
<br>
 }</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The Service Description Exchange data and packet structures. A Service description exchange (<b>SDE</b>) happens when a user connects to a particular AP to retrieve the details of the <a class="el" href="structservice.html">service</a> offered in the SSID. The data exchange will be modeled after the latest Android ToDo protocol that employs static packet structures and TLV chunks. The data are aligned properly as can be seen in detail in the C implementation at the end of this document. Once the gadget gets an IP address, it should connect to UDP port 30003 to start the following communication sequence:. 
<p>
<ol>
<li>
GET_METADATA (can be skipped) <ul>
<li>
If there is no answer after a timeout, the gadget can notify the user that the AP is not responding. The user can then choose to retry. </li>
<li>
One use of <a class="el" href="structmetadata.html">metadata</a> is to enable caching of information like what is used in HTML proxy. </li>
</ul>
<dl>
<dt><b>Response</b> </dt>
<dd><ol>
<li>
METADATA: METADATA_COUNT <ul>
<li>
The METADATA_COUNT tells the gadget how many "struct metadata" is contained in the packet that follows. </li>
</ul>
</li>
<li>
METADATA_DATA: METADATA_COUNT, TSES <ul>
<li>
METADATA_COUNT is the corresponding METADATA's METADATA_COUNT. </li>
<li>
TSES are the last modification timestamps of the published services in the SSID. The timestamps are ordered according to the <a class="el" href="structservice.html">service</a> positions in the SSID. A timestamp is the number of seconds since the Unix epoch stored in 8 bytes. </li>
<li>
A TLV chunk is not employed here because, I think, <a class="el" href="structmetadata.html">metadata</a> negotiation has to be fast. </li>
</ul>
</li>
</ol>
</dd>
</dl>
</li>
<li>
GET_SERVICE_DESCRIPTION: POSITION_COUNT <ul>
<li>
The SERVICE_ID_COUNT tells the AP how many "struct position" is contained in the packet that follows. </li>
</ul>
</li>
<li>
GET_SERVICE_DESCRIPTION_DATA: POSITION_COUNT, POSITIONS <ul>
<li>
POSITION_COUNT is the corresponding GET_SERVICE_DESCRIPTION's POSITION_COUNT. </li>
<li>
POSITIONS are the positions of the services that are published in the SSID so that the AP can send only the needed data as the gadget wants. A <a class="el" href="structposition.html">position</a> starts from 0 and is stored in 1 byte. </li>
</ul>
<dl>
<dt><b>Response</b> </dt>
<dd><ol>
<li>
SERVICE_DESCRIPTION: TOTAL_BYTES <ul>
<li>
The TOTAL_BYTES tells the gadget how many bytes is contained in the packet that follows. </li>
</ul>
</li>
<li>
SERVICE_DESCRIPTION_DATA: TOTAL_BYTES, TLV_DATA <ul>
<li>
TOTAL_BYTES is the corresponding SERVICE_DESCRIPTION's TOTAL_BYTES. </li>
<li>
TLV_DATA are TLV chunks for each of the requested <a class="el" href="structposition.html">position</a>. <b>[CAUTION]</b> Not all requested <a class="el" href="structservice.html">service</a> descriptions may be present (e.g., a <a class="el" href="structservice.html">service</a> can be disabled by the AP owner). Each chunk currently contains the following information represented as nested TLV chunks: <ul>
<li>
Last modification timestamp. </li>
<li>
Service long description. </li>
<li>
URI to obtain the <a class="el" href="structservice.html">service</a> (e.g., rss://xxx). </li>
</ul>
</li>
<li>
TLV is used here since more information can be added in the future (e.g., a small picture) or the information can be tailored to the <a class="el" href="structservice.html">service</a> category. </li>
</ul>
</li>
</ol>
</dd>
</dl>
</li>
</ol>
<b>[CAUTION]</b> GET_METADATA and the corresponding METADATA reply communication session can be skipped (i.e., GET_SERVICE_DESCRIPTION can be issued without issuing GET_METADATA first). <h1>Why duplicated "count" and "size" fields in <a class="el" href="structsde__metadata__data.html">sde_metadata_data</a>, <a class="el" href="structsde__get__service__desc__data.html">sde_get_service_desc_data</a> and <a class="el" href="structsde__service__desc__data.html">sde_service_desc_data</a>?</h1>
<p>
The duplicated count and size fields are there so that an AP or a gadget that are capable of using ioctl (..., FIONREAD, ...) to look the size of the next pending UDP datagram without retrieving the UDP datagram from the socket can save memory by not remembering the previously received announcement. The announcement scheme (preceding the variable length data packet with an announcement packet) is used because Android's Java requires a prior knowledge about the length of the next UDP datagram before you can retrieve the UDP datagram without truncation (i.e., there is no equivalent of FIONREAD in Java, but CMIIW). <h1>Beware of outdated data</h1>
<p>
Consider the following sequence of communication with an AP: <table border="1" cellspacing="3" cellpadding="3">
<tr>
<th>Gadget </th><th>AP  </th></tr>
<tr>
<td>get_metadata </td><td></td></tr>
<tr>
<td></td><td><a class="el" href="structmetadata.html">metadata</a> (count = 2)  </td></tr>
<tr>
<td>get_service_description<br>
 (count = 1, <a class="el" href="structposition.html">position</a> = 0) </td><td></td></tr>
<tr>
<td></td><td>Owner deletes <a class="el" href="structservice.html">service</a> #1, <a class="el" href="structservice.html">service</a> #2 has <a class="el" href="structposition.html">position</a> = 0  </td></tr>
<tr>
<td></td><td>service_description<br>
 (carries <a class="el" href="structservice.html">service</a> description #2 instead of #1 as the gadget requested)  </td></tr>
</table>
As illustrated above, the gadget software should anticipate for such a discrepancy between the previous and current information by checking the last modification timestamp. <hr><h2>Define Documentation</h2>
<a class="anchor" name="3cae2d1065c37163cc29ca5874abb904"></a><!-- doxytag: member="sde.h::SDE_PORT" ref="3cae2d1065c37163cc29ca5874abb904" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SDE_PORT&nbsp;&nbsp;&nbsp;30003          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The AP port for an SDE session. 
</div>
</div><p>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="edbe138a09311afa037d3add2468d640"></a><!-- doxytag: member="sde.h::sde_packet_type" ref="edbe138a09311afa037d3add2468d640" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="sde_8h.html#edbe138a09311afa037d3add2468d640">sde_packet_type</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Service Description Exchange packet types. <dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d6404428e5f642432448da74290c4a70173e"></a><!-- doxytag: member="GET_METADATA" ref="edbe138a09311afa037d3add2468d6404428e5f642432448da74290c4a70173e" args="" -->GET_METADATA</em>&nbsp;</td><td>
A <a class="el" href="structmetadata.html">metadata</a> request. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d6400e1d7082456940b59823eed8099493ca"></a><!-- doxytag: member="METADATA" ref="edbe138a09311afa037d3add2468d6400e1d7082456940b59823eed8099493ca" args="" -->METADATA</em>&nbsp;</td><td>
A <a class="el" href="structmetadata.html">metadata</a> response. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d640e4d7b97f100ece56b1dcfb19d8312fdc"></a><!-- doxytag: member="METADATA_DATA" ref="edbe138a09311afa037d3add2468d640e4d7b97f100ece56b1dcfb19d8312fdc" args="" -->METADATA_DATA</em>&nbsp;</td><td>
The <a class="el" href="structmetadata.html">metadata</a> response data. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d640c626f3311c4accefb1fe659e53ffab61"></a><!-- doxytag: member="GET_SERVICE_DESC" ref="edbe138a09311afa037d3add2468d640c626f3311c4accefb1fe659e53ffab61" args="" -->GET_SERVICE_DESC</em>&nbsp;</td><td>
A <a class="el" href="structservice.html">service</a> description request. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d640bd8f61f35a1f8df3f3d535b16440a1dc"></a><!-- doxytag: member="GET_SERVICE_DESC_DATA" ref="edbe138a09311afa037d3add2468d640bd8f61f35a1f8df3f3d535b16440a1dc" args="" -->GET_SERVICE_DESC_DATA</em>&nbsp;</td><td>
The <a class="el" href="structservice.html">service</a> description request data. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d6400c6eddfb28096f33fc47e0eaa0588d88"></a><!-- doxytag: member="SERVICE_DESC" ref="edbe138a09311afa037d3add2468d6400c6eddfb28096f33fc47e0eaa0588d88" args="" -->SERVICE_DESC</em>&nbsp;</td><td>
The <a class="el" href="structservice.html">service</a> description response. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="edbe138a09311afa037d3add2468d640acc47865511e3fb052c9777361bf5bda"></a><!-- doxytag: member="SERVICE_DESC_DATA" ref="edbe138a09311afa037d3add2468d640acc47865511e3fb052c9777361bf5bda" args="" -->SERVICE_DESC_DATA</em>&nbsp;</td><td>
The <a class="el" href="structservice.html">service</a> description response data. </td></tr>
</table>
</dl>

</div>
</div><p>
<a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28"></a><!-- doxytag: member="sde.h::service_desc_chunk_type" ref="6ae07eed4365b800c09d7b22bacd7a28" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28">service_desc_chunk_type</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The type of a chunk contained in a <a class="el" href="structservice.html">service</a> description data. <dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28b6018339139b51a498dc44bd760766fc"></a><!-- doxytag: member="DESCRIPTION" ref="6ae07eed4365b800c09d7b22bacd7a28b6018339139b51a498dc44bd760766fc" args="" -->DESCRIPTION</em>&nbsp;</td><td>
The <a class="el" href="structservice.html">service</a> description of a <a class="el" href="structservice.html">service</a> at a particular <a class="el" href="structposition.html">position</a>. The value is a set of chunks of <a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28feaef8a658b26a4d579bc6b737454b22">SERVICE_POS</a>, <a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28267d1e553ddae7b4a94965d90362173d">SERVICE_TS</a>, <a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28266791ced345bfe6511dd4acab8d0b28">SERVICE_LONG_DESC</a> and <a class="el" href="sde_8h.html#6ae07eed4365b800c09d7b22bacd7a28dff633207be6c7a92d0462413ae8ce7e">SERVICE_URI</a> (i.e., nested TLV chunks). </td></tr>
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28feaef8a658b26a4d579bc6b737454b22"></a><!-- doxytag: member="SERVICE_POS" ref="6ae07eed4365b800c09d7b22bacd7a28feaef8a658b26a4d579bc6b737454b22" args="" -->SERVICE_POS</em>&nbsp;</td><td>
The <a class="el" href="structposition.html">position</a> of a particular <a class="el" href="structservice.html">service</a> as advertised in the SSID starting from 0 and encoded as 1 octet value. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28267d1e553ddae7b4a94965d90362173d"></a><!-- doxytag: member="SERVICE_TS" ref="6ae07eed4365b800c09d7b22bacd7a28267d1e553ddae7b4a94965d90362173d" args="" -->SERVICE_TS</em>&nbsp;</td><td>
The last-modification timestamp in second of a particular <a class="el" href="structservice.html">service</a> since Unix epoch encoded as 8 octet value. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28266791ced345bfe6511dd4acab8d0b28"></a><!-- doxytag: member="SERVICE_LONG_DESC" ref="6ae07eed4365b800c09d7b22bacd7a28266791ced345bfe6511dd4acab8d0b28" args="" -->SERVICE_LONG_DESC</em>&nbsp;</td><td>
The long description of a particular <a class="el" href="structservice.html">service</a> encoded in UTF-8. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28dff633207be6c7a92d0462413ae8ce7e"></a><!-- doxytag: member="SERVICE_URI" ref="6ae07eed4365b800c09d7b22bacd7a28dff633207be6c7a92d0462413ae8ce7e" args="" -->SERVICE_URI</em>&nbsp;</td><td>
The URI to obtain a particular <a class="el" href="structservice.html">service</a> encoded in UTF-8. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a28f09c66ca77d031a035371f689ff64f6f"></a><!-- doxytag: member="SERVICE_SHORT_DESC" ref="6ae07eed4365b800c09d7b22bacd7a28f09c66ca77d031a035371f689ff64f6f" args="" -->SERVICE_SHORT_DESC</em>&nbsp;</td><td>
The short description of a particular <a class="el" href="structservice.html">service</a> encoded in UTF-8. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="6ae07eed4365b800c09d7b22bacd7a2868ddd2ab2bd2b40f8c7f3fa8983fd321"></a><!-- doxytag: member="SERVICE_CAT_ID" ref="6ae07eed4365b800c09d7b22bacd7a2868ddd2ab2bd2b40f8c7f3fa8983fd321" args="" -->SERVICE_CAT_ID</em>&nbsp;</td><td>
The category ID of a particular <a class="el" href="structservice.html">service</a> encoded as 4 octets unsigned value. </td></tr>
</table>
</dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Mar 4 18:01:13 2010 for AP Service Publisher by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
